"main";let fs;_7b1‍.w("fs",[["default",["fs"],function(v){fs=v}]]);let connectDb,clearDatabase,createDbNode;_7b1‍.w("./database.js",[["connectDb",["connectDb"],function(v){connectDb=v}],["clearDatabase",["clearDatabase"],function(v){clearDatabase=v}],["createDbNode",["createDbNode"],function(v){createDbNode=v}]]);



async function setupDb(){
    const db = connectDb()
    await clearDatabase(db)
    
    const collectionsToCreate = [
            'market',
            'currency',
            'exchange'
        ]
        
    for (let collection of collectionsToCreate){
        await db.collection(collection).create()
    }
    return
    // exchanges dir is read to load js files
    fs.readdir('exchanges', async (err,moduleFiles)=>{
        
        // modules are loaded in a object
        let exchangeModules = {}
        for (const moduleFile of moduleFiles){
            const exchangeName = moduleFile.split('.')[0]
            exchangeModules[exchangeName] = require(`./exchanges/${moduleFile}`)
            break
        }
        
        // then markets, currencies and exchanges documentsare create
        let markets = {}
        for (let exchangeModuleName of Object.keys(exchangeModules)){
            const module = exchangeModules[exchangeModuleName][exchangeModuleName]
            const markets = await module.fetchMarkets()
            
            let marketNodes = {}
            let currencyNodes = {}
            let exchangeNodes = {}
            let edges = []
            
            for (let market of markets){
                
                const marketLabel = `${market.exchange} - ${market.baseCurrency}/${market.quoteCurrency}`
                if (!Object.keys(marketNodes).includes(marketLabel)){
                    marketNodes[marketLabel] = await createDbNode(db, 'market', {label: marketLabel})
                }
                
                if (!Object.keys(currencyNodes).includes(market.baseCurrency)){
                    currencyNodes[market] = await createDbNode(db, 'currency', {label: market.baseCurrency})
                }
                
                if (!Object.keys(currencyNodes).includes(market.quoteCurrency)){
                    currencyNodes[market.quoteCurrency] = await createDbNode(db, 'currency', {label: market.quoteCurrency})
                }
                
                if (!Object.keys(exchangeNodes).includes(market.exchange)){
                    exchangeNodes[market.exchange] = await createDbNode(db, 'exchange', {label: market.exchange})
                }
                
            
                
             
                
                
                // connectDbNodes('market_has_exchange', market, exchanges[pair.exchange])
                // connectDbNodes('market_has_baseCurrency', market, currencyNodes[pair.baseCurrency])
                // connectDbNodes('market_has_quoteCurrency', market, currencyNodes[pair.quoteCurrency])
                
            }
        }
    })
}





setupDb()